=encoding utf8

=for comment
This has been completed up to aebc0cbe, except for:
bb789b09de07edfb74477eb1603949c96d60927d (Dave Mitchell)

=head1 NAME

[ this is a template for a new perldelta file. Any text flagged as
XXX needs to be processed before release. ]

perldelta - what is new for perl v5.15.1

=head1 DESCRIPTION

This document describes differences between the 5.15.1 release and
the 5.15.0 release.

If you are upgrading from an earlier release such as 5.14.0, first read
L<perl5150delta>, which describes differences between 5.14.0 and
5.15.0.

=head1 Notice

XXX Any important notices here

=head1 Core Enhancements

XXX New core language features go here. Summarise user-visible core language
enhancements. Particularly prominent performance optimisations could go
here, but most should go in the L</Performance Enhancements> section.

[ List each enhancement as a =head2 entry ]

=head2 C<splice()> doesn't warn when truncating

You can now limit the size of an array using C<splice(@a,MAX_LEN)> without
worrying about warnings.

=head2 The C<\$> prototype accepts any scalar lvalue

The C<\$> and C<\[$]> subroutine prototypes now accept any scalar lvalue
argument.  Previously they only accepted scalars beginning with C<$> and
hash and array elements.  This change makes them consistent with the way
the built-in C<read> and C<recv> functions (among others) parse their
arguments. This means that one can override the built-in functions with
custom subroutines that parse their arguments the same way.

=head2 You can now C<study> more than one string

The restriction that you can only have one C<study> active at a time has been
removed. You can now usefully C<study> as many strings as you want (until you
exhaust memory).

=head2 The Unicode C<Script_Extensions> property is now supported.

New in Unicode 6.0, this is an improved C<Script> property.  Details
are in L<perlunicode/Scripts>.

=head2 DTrace probes for interpreter phase change

The C<phase-change> probes will fire when the interpreter's phase
changes, which tracks the C<${^GLOBAL_PHASE}> variable. C<arg0> is
the new phase name; C<arg1> is the old one. This is useful mostly
for limiting your instrumentation to one or more of: compile time,
run time, destruct time.

=head2 New Pad API

Many new functions have been added to the API for manipulating lexical
pads.  See L<perlapi/Pad Data Structures> for more information.

=head1 Security

XXX Any security-related notices go here.  In particular, any security
vulnerabilities closed should be noted here rather than in the
L</Selected Bug Fixes> section.

[ List each security issue as a =head2 entry ]

=head1 Incompatible Changes

XXX For a release on a stable branch, this section aspires to be:

    There are no changes intentionally incompatible with 5.XXX.XXX
    If any exist, they are bugs and reports are welcome.

[ List each incompatible change as a =head2 entry ]

=head1 Deprecations

XXX Any deprecated features, syntax, modules etc. should be listed here.
In particular, deprecated modules should be listed here even if they are
listed as an updated module in the L</Modules and Pragmata> section.

[ List each deprecation as a =head2 entry ]

=head1 Performance Enhancements

XXX Changes which enhance performance without changing behaviour go here. There
may well be none in a stable release.

[ List each enhancement as a =item entry ]

=over 4

=item *

The short-circuiting operators C<&&>, C<||>, and C<//> are now
considerably faster in the short-circuiting case due to reduced
OP-tree traversal.

=item *

The implementation of C<s///r> makes one less copy of the scalar's value.

=item *

If a studied scalar is C<split> with a regex, the engine will now take
advantage of the C<study> data.

=item *

C<study> now uses considerably less memory for shorter strings. Strings shorter
than 65535 characters use roughly half the memory than previously, strings
shorter than 255 characters use roughly one quarter of the memory.

=item *

Recursive calls to lvalue subroutines in lvalue scalar context use less
memory.

=back

=head1 Modules and Pragmata

XXX All changes to installed files in F<cpan/>, F<dist/>, F<ext/> and F<lib/>
go here.  If Module::CoreList is updated, generate an initial draft of the
following sections using F<Porting/corelist-perldelta.pl>, which prints stub
entries to STDOUT.  Results can be pasted in place of the '=head2' entries
below.  A paragraph summary for important changes should then be added by hand.
In an ideal world, dual-life modules would have a F<Changes> file that could be
cribbed.

[ Within each section, list entries as a =item entry ]

=head2 New Modules and Pragmata

=over 4

=item *

The logic for parsing, merging, and dumping XS typemaps has been extracted
from C<ExtUtils::ParseXS> into a module of its own, L<ExtUtils::Typemaps>.
C<ExtUtils::Typemaps> offers an interface to typemap handling outside of
the scope of the XS compiler itself.

As a first use case of the improved API and extensibility, typemaps can now
be included inline in XS code with a HEREDOC-like syntax:

  TYPEMAP: <<END_TYPEMAP
  MyType	T_IV
  END_TYPEMAP

=back

=head2 Updated Modules and Pragmata

=over 4

=item *

L<B::Deparse> has been upgrade from version 1.05 to 1.06.

It now correctly deparses interpolation of punctuation variables (like
C<@*>) that do not interpolate without braces [perl #93990].

=item *

L<CGI> has been upgraded from version 3.54 to version 3.55

[THINGS THAT MAY BREAK YOUR CODE]

C<url()> was fixed to return C<PATH_INFO> when it is explicitly requested
with either the path=>1 or path_info=>1 flag.

If your code is running under mod_rewrite (or compatible) and you are calling C<self_url()> or
you are calling C<url()> and passing path_info=>1, These methods will actually be
returning C<PATH_INFO> now, as you have explicitly requested, or has C<self_url()>
has requested on your behalf.

The C<PATH_INFO> has been omitted in such URLs since the issue was introduced
in the 3.12 release in December, 2005.

This bug is so old your application may have come to depend on it or
workaround it. Check for application before upgrading to this release.

Examples of affected method calls:

  $q->url(-absolute => 1, -query => 1, -path_info => 1 )
  $q->url(-path=>1)
  $q->url(-full=>1,-path=>1)
  $q->url(-rewrite=>1,-path=>1)
  $q->self_url();

=item *

L<Compress::Raw::Bzip2> has been upgraded from version 2.035 to version 2.037

=item *

L<Compress::Raw::Zlib> has been upgraded from version 2.035 to version 2.037

Added offset parameter to CRC32

=item *

L<Compress::Zlib> has been upgraded from version 2.035 to version 2.037

IO::Compress::Zip and IO::Uncompress::Unzip now have support for LZMA (method 14).
There is a fix for a CRC issue in IO::Compress::Unzip and it supports Streamed
Stored context now. And fixed a Zip64 issue in
IO::Compress::Zip when the content size was exactly 0xFFFFFFFF.

=item *

L<CPANPLUS> has been upgraded from version 0.9105 to version 0.9108

=item *

L<Cwd> has been upgraded from version 3.36 to 3.37, to address an
incompatibility with the EPIC debugger.

=item *

L<diagnostics> has been upgraded from version 1.22 to 1.23.

It now knows how to find descriptions for diagnostic messages ending with a
dot, instead getting confused by it.

=item *

L<ExtUtils::MakeMaker> has been upgraded from version 6.57_05 to version 6.58

=item *

L<ExtUtils::ParseXS> has been upgraded from version 2.2210 to 3.00_01.

Much of L<ExtUtils::ParseXS>, the module behind the XS compiler C<xsubpp>,
was rewritten and cleaned up. It has been made somewhat more extensible
and now finally uses strictures.

The typemap logic has been moved into a separate module,
L<ExtUtils::Typemaps>.  See L</New Modules and Pragmata>, above.

=item *

L<IPC::Cmd> has been upgraded from version 0.70 to version 0.72

Capturing of command output (both C<STDOUT> and C<STDERR>) is now supported
using L<IPC::Open3> on MSWin32 without requiring L<IPC::Run>.

=item *

L<Locale::Codes> has been upgraded from version 3.16 to version 3.17

Added Language Extension codes (langext) and Language Variation codes
(langvar) as defined in the IANA language registry.

Added language codes from ISO 639-5

Added language/script codes from the IANA language subtag
registry

Fixed an uninitialized value warning.  RT 67438

Fixed the return value for the all_XXX_codes and all_XXX_names functions.  RT 69100

Reorganized modules to move Locale::MODULE to Locale::Codes::MODULE to
allow for cleaner future additions.  The original four modules (Locale::Language,
Locale::Currency, Locale::Country, Locale::Script) will continue to work, but
all new sets of codes will be added in the Locale::Codes namespace.

=item *

L<attributes> has been upgraded from version 0.14 to 0.15, as part of the
lvalue attribute warnings fix.  See L</Selected Bug Fixes>, below.

=item *

L<Math::BigInt::FastCalc> has been upgraded from version 0.28 to version 0.29.

The XS code is now compiled with C<PERL_NO_GET_CONTEXT>, which will aid
performance under ithreads.

=item *

L<Module::CoreList> has been upgraded from version 2.51 to 2.53.

Some extraneous (and erroneous) entries have been removed
[rt.cpan.org #69108].

The C<corelist> utility now understands the C<-r> option for
displaying Perl release dates.

=item *

L<Pod::Perldoc> has been upgraded from version 3.15_05 to 3.15_06.

The B<-v> option now fetches the right section for C<$0>.

=item *

L<Pod::Simple> has been upgraded from version 3.16 to version 3.18

=item *

L<Unicode::Collate> has been upgraded from version 0.76 to version 0.77

Applied [perl #93470] silencing compiler warnings with -Wwrite-strings

=item *

L<Win32API::File> has been upgraded from version 0.1101 to version 0.1200

Added SetStdHandle and GetStdHandle functions

=item *

L<threads> has been upgraded from version 1.83 to 1.84

An unused variable was removed from the XS code.

=back

=head2 Removed Modules and Pragmata

=over 4

=item *

Perl 4-era .pl libraries

Perl used to bundle a handful of library files that predate Perl 5. Most of
these files, which have been deprecated since version 5.14.0, have now been
removed. If your code still relies on these libraries, you can install them
again from C<Perl4::CoreLibs> on CPAN.

=back

=head1 Documentation

XXX Changes to files in F<pod/> go here.  Consider grouping entries by
file and be sure to link to the appropriate page, e.g. L<perlfunc>.

=head2 New Documentation

XXX Changes which create B<new> files in F<pod/> go here.

=head3 L<perldtrace>

L<perldtrace> describes Perl's DTrace support, listing the provided probes
and gives examples of their use.

=head3 L<perl5141delta>

The delta file for Perl 5.14.1 has been copied to blead.

=head2 Changes to Existing Documentation

XXX Changes which significantly change existing files in F<pod/> go here.
However, any changes to F<pod/perldiag.pod> should go in the L</Diagnostics>
section.

=head3 L<XXX>

=over 4

=item *

XXX Description of the change here

=item *

L<perlxs> was extended with documentation on inline typemaps.

=item *

L<perlref> has a new L<Circular References|perlref/Circular References>
section explaining how circularities may not be freed and how to solve that
with weak references.

=item *

The documentation for smart match in L<perlsyn> has been corrected for the
case of C<undef> on the left-hand side.  The list of different smart match
behaviours had an item in the wrong place.

=back

=head1 Diagnostics

The following additions or changes have been made to diagnostic output,
including warnings and fatal error messages.  For the complete list of
diagnostic messages, see L<perldiag>.

XXX New or changed warnings emitted by the core's C<C> code go here. Also
include any changes in L<perldiag> that reconcile it to the C<C> code.

[ Within each section, list entries as a =item entry that links to perldiag,
  e.g.

  =item *

  L<Invalid version object|perldiag/"Invalid version object">
]

=head2 New Diagnostics

XXX Newly added diagnostic messages go here

=head3 New Errors

=over 4

=item *

XXX L<message|perldiag/"message">

=back

=head3 New Warnings

=over 4

=item *

XXX L<message|perldiag/"message">

=back

=head2 Changes to Existing Diagnostics

XXX Changes (i.e. rewording) of diagnostic messages go here

=over 4

=item *

The L<Invalid version format|perldiag/"Invalid version format (%s)">
error message now says "negative version number" within the parentheses,
rather than "non-numeric data", for negative numbers.

=item *

The two warnings
L<Possible attempt to put comments in qw() list|perldiag/"Possible attempt to put comments in qw() list">
and
L<Possible attempt to separate words with commas|perldiag/"Possible attempt to separate words with commas">
are no longer mutually exclusive: the same C<qw> construct may produce
both.

=item *

Warnings that mention the names of lexical (C<my>) variables with Unicode
characters in them now respect the presence or absence of the C<:utf8>
layer on the output handle, instead of outputting UTF8 regardless.  Also,
the correct names are included in the strings passed to C<$SIG{__WARN__}>
handlers, rather than the raw UTF8 bytes.

=back

=head1 Utility Changes

XXX Changes to installed programs such as F<perlbug> and F<xsubpp> go
here. Most of these are built within the directories F<utils> and F<x2p>.

[ List utility changes as a =head3 entry for each utility and =item
entries for each change
Use L<XXX> with program names to get proper documentation linking. ]

=head3 L<XXX>

=over 4

=item *

XXX

=back

=head1 Configuration and Compilation

XXX Changes to F<Configure>, F<installperl>, F<installman>, and analogous tools
go here.  Any other changes to the Perl build process should be listed here.
However, any platform-specific changes should be listed in the
L</Platform Support> section, instead.

[ List changes as a =item entry ].

=over 4

=item *

XXX

=back

=head1 Testing

XXX Any significant changes to the testing of a freshly built perl should be
listed here.  Changes which create B<new> files in F<t/> go here as do any
large changes to the testing harness (e.g. when parallel testing was added).
Changes to existing files in F<t/> aren't worth summarising, although the bugs
that they represent may be covered elsewhere.

[ List each test improvement as a =item entry ]

=over 4

=item *

F<t/run/dtrace.t> was added to test Perl's DTrace support. This
test will only be run if your Perl was built with C<-Dusedtrace>
and if calling C<dtrace> actually lets you instrument code. This
generally requires being run as root, so this test file is primarily
intended for use by the dtrace subcommittee of p5p.

=back

=head1 Platform Support

XXX Any changes to platform support should be listed in the sections below.

[ Within the sections, list each platform as a =item entry with specific
changes as paragraphs below it. ]

=head2 New Platforms

XXX List any platforms that this version of perl compiles on, that previous
versions did not. These will either be enabled by new files in the F<hints/>
directories, or new subdirectories and F<README> files at the top level of the
source tree.

=over 4

=item XXX-some-platform

XXX

=back

=head2 Discontinued Platforms

XXX List any platforms that this version of perl no longer compiles on.

=over 4

=item XXX-some-platform

XXX

=back

=head2 Platform-Specific Notes

XXX List any changes for specific platforms. This could include configuration
and compilation changes or changes in portability/compatibility.  However,
changes within modules for platforms should generally be listed in the
L</Modules and Pragmata> section.

=over 4

=item XXX-some-platform

XXX

=back

=head1 Internal Changes

XXX Changes which affect the interface available to C<XS> code go here.
Other significant internal changes for future core maintainers should
be noted as well.

[ List each change as a =item entry ]

=over 4

=item *

The expermental C<fetch_cop_label> function has been renamed to
C<cop_fetch_label>.

=item *

The C<cop_store_label> function has been added to the API, but is
experimental.

=back

=head1 Selected Bug Fixes

XXX Important bug fixes in the core language are summarised here.
Bug fixes in files in F<ext/> and F<lib/> are best summarised in
L</Modules and Pragmata>.

[ List each fix as a =item entry ]

=over 4

=item *

Applying the :lvalue attribute to subroutine that is already defined does
not work properly, as the attribute changes the way the sub is compiled.
Hence, Perl 5.12 began warning when an attempt is made to apply the
attribute to an already defined sub.  In such cases, the attribute is
discarded.

But the change in 5.12 missed the case where custom attributes are also
present: that case still silently and ineffectively applied the attribute.
That omission has now been corrected.  C<sub foo :lvalue :Whatever> (when
C<foo> is already defined) now warns about the :lvalue attribute, and does
not apply it.

L<attributes.pm|attributes> has likewise been updated to warn and not apply
the attribute.

=item *

=for comment
Not necessary for perl5160delta

The remaining discrepancies between explicit and implicit return from
lvalue subroutines have been resolved.  They mainly involved which error
message to display when a read-only value is returned in lvalue context.
Also, returning a PADTMP (the result of most built-ins, like C<index>) in
lvalue context is now forbidden for explicit return, as it always has been
for implicit return.  This is not a regression from 5.14, as all the cases
in which it could happen where previously syntax errors.

=item *

=for comment
Not necessary for perl5160delta

Explicitly returning a tied C<my> variable from an lvalue subroutine in
list lvalue context used to clear the variable before the assignment could
happen.  This is something that was missed when explicit return was made to
work in 5.15.0.

=item *

=for comment
Not necessary for perl5160delta

A minor memory leak, introduced in 5.15.0, has been fixed.  It would occur
when a hash is freed that has had its current iterator deleted
[perl #93454].

=item *

The C<prototype> function now returns a prototype (the empty string) for
the C<__FILE__>, C<__LINE__> and C<__PACKAGE__> directives, instead of
dying, as they are indistinguishable syntactically from nullary functions
like C<time>.

=item *

A bug affecting lvalue context propagation through nested lvalue subroutine
calls has been fixed.  Previously, returning a value in nested rvalue
context would be treated as lvalue context by the inner subroutine call,
resulting in some values (such as read-only values) being rejected.

=item *

Some core bugs affecting L<Hash::Util> have been fixed: locking a hash
element that is a glob copy no longer causes subsequent assignment to it to
corrupt the glob, and unlocking a hash element that holds a copy-on-write
scalar no longer causes modifications to that scalar to modify other
scalars that were sharing the same string buffer.

=item *

C<when> blocks are now capable of returning variables declared inside the
enclosing C<given> block [perl #93548].

=item *

A problem with context propagation when a C<do> block is an argument to
C<return> has been fixed.  It used to cause undefined to be returned in
some cases of a C<return> inside an C<if> block which itself is followed by
another C<return>.

=item *

Calling C<index> with a tainted constant no longer causes constants in
subsequently compiled code to become tainted [perl #64804].

=item *

The peephole optimiser uses less recursion than before, making it possible
to evaluate code like C<eval ("{\$x = 1 }\n" x 100000)> without a crash.

=item *

Use of lexical (C<my>) variables in code blocks embedded in regular
expressions will no longer result in memory corruption or crashes.

Nevertheless, these code blocks are still experimental, as there are still
problems with the wrong variables being closed over (in loops for instance)
and with abnormal exiting (e.g., C<die>) causing memory corruption.

=item *

The C<SvIsCOW> C macro now returns false for read-only copies of typeglobs,
such as those created by:

  $hash{elem} = *foo;
  Hash::Util::lock_value %hash, 'elem';

It used to return true.

=back

=head1 Known Problems

XXX Descriptions of platform agnostic bugs we know we can't fix go here. Any
tests that had to be C<TODO>ed for the release would be noted here, unless
they were specific to a particular platform (see below).

This is a list of some significant unfixed bugs, which are regressions
from either 5.XXX.XXX or 5.XXX.XXX.

[ List each fix as a =item entry ]

=over 4

=item *

XXX

=back

=head1 Obituary

XXX If any significant core contributor has died, we've added a short obituary
here.

=head1 Acknowledgements

Generate this with:

  perl Porting/acknowledgements.pl v5.15.0..HEAD

=head1 Reporting Bugs

If you find what you think is a bug, you might check the articles
recently posted to the comp.lang.perl.misc newsgroup and the perl
bug database at http://rt.perl.org/perlbug/ .  There may also be
information at http://www.perl.org/ , the Perl Home Page.

If you believe you have an unreported bug, please run the L<perlbug>
program included with your release.  Be sure to trim your bug down
to a tiny but sufficient test case.  Your bug report, along with the
output of C<perl -V>, will be sent off to perlbug@perl.org to be
analysed by the Perl porting team.

If the bug you are reporting has security implications, which make it
inappropriate to send to a publicly archived mailing list, then please send
it to perl5-security-report@perl.org. This points to a closed subscription
unarchived mailing list, which includes
all the core committers, who will be able
to help assess the impact of issues, figure out a resolution, and help
co-ordinate the release of patches to mitigate or fix the problem across all
platforms on which Perl is supported. Please only use this address for
security issues in the Perl core, not for modules independently
distributed on CPAN.

=head1 SEE ALSO

The F<Changes> file for an explanation of how to view exhaustive details
on what changed.

The F<INSTALL> file for how to build Perl.

The F<README> file for general stuff.

The F<Artistic> and F<Copying> files for copyright information.

=cut
